pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- main game
function _init()
		state=intro
end

function _update()
	state.update()
end

function _draw()
	state.draw()
end
-->8
-- states
intro = {
	update = function()
			if btnp(4) then
					state=menu
			end
	end,	
	draw = function()
			cls()
			print("neural trainer",10,10)
			print("game made by roberto freire",10,30)
	end
}

menu = {
	update = function()
			if btnp(4) then
					state=game
					game.init()
			end
			
			if btnp(0) and curtlvl > 0 then
					curtlvl-=1
			end
			
			if btnp(1) and curtlvl < #levels then
					curtlvl+=1
			end
	end,	
	draw = function()
			cls()
			
			for i=1,#levels do
					spr(i,12+(i-1)*16,16)
					if curtlvl == i then
							spr(48,12+(i-1)*16,16)
					end
			end
	end
}

game = {
	init = function()
		levels[curtlvl]:init()
	end,
	update = function()
			if btnp(5) then
					state=menu
			end
			levels[curtlvl]:update()
	end,	
	draw = function()
			cls()
			levels[curtlvl]:draw()
			nt:draw()
	end
}

-->8
-- levels
curtlvl=1
levels = {}

levels[1] = {
	dino_x = 2,
	dino_y = 56,
	dino_vy = 0,
	on_ground = true,
	obstacle={},
	obs_speed = 2,
	add_obstacle = function(this)
	  this.obstacle={x = flr(128+rnd(128))}
			this.obs_speed=flr(1+rnd(2))
	end,
	init = function(this)
			this:add_obstacle()
	end,
	update = function(this)
			this.obstacle.x -= this.obs_speed
      
   if this.obstacle.x < -8 then
     this:add_obstacle()
   end
   
   local x0 = this.dino_x - this.obstacle.x
   
   if nt:calcy(x0) > 0 and this.on_ground then
    this.dino_vy = -4
    this.on_ground = false
   end
   
   this.dino_y += this.dino_vy
   if not this.on_ground then
       this.dino_vy += 0.3
   end
   if this.dino_y >= 56 then
       this.dino_y = 56
       this.dino_vy = 0
       this.on_ground = true
   end
	end,
	draw = function(this)
	 rectfill(0, 0, 127, 63, 15)
  line(0, 64, 127, 64, 14)
  spr(1,this.dino_x, this.dino_y)
  spr(32,this.obstacle.x, 56)
	end
}

levels[2] = {
	init = function(this)
	end,
	update = function(this)
	end,
	draw = function(this)
			print("level: "..2,10,10)
	end
}

-->8
-- neural network
nt={
	tmrnt = 0,
	input={
		{
			label="dist",
			desc="distance between dino and obstacle",	
			value=0
		}
	},
	node={
		{
				w0=1,
				b=20 -- mockup values
		}
	},
	calcy=function(this,x0)   
		this.tmrnt += 1
		if this.tmrnt > 5 then
			this.tmrnt = 0
			-- fix this to be dinamic
			this.input[1].value=x0
			return x0 * this.node[1].w0 + this.node[1].b
		end
		return 0
	end,
	draw=function(this)
		for i=1,#this.input do
			spr(54,0,64+(i-1)*16)
			print(this.input[i].value,0,72+(i-1)*16,12)
		end
	end
}
__gfx__
00000000000033330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000030330550055200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000033332088800200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000300333002882288200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000333333302882288200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700033333002088800200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000033330000550055200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000ee0e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0ee0e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0eeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0eeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c0c0c0c006556000055660000666600006666000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0000000066556600655666005566660066666600666666000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000c666556666655666665556666555666666666666600111100003333000088880000000000000000000000000000000000000000000000000000000000
c0000000666556666665566666555666555556665555566601cccc1003bbbb3008eeee8000000000000000000000000000000000000000000000000000000000
0000000c666556666665566666655666666556665555566601cccc1003bbbb3008eeee8000000000000000000000000000000000000000000000000000000000
c0000000666666666666666666666666666666666666666600111100003333000088880000000000000000000000000000000000000000000000000000000000
0000000c066666600666666006666660066666600666666000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0c0c0c0006666000066660000666600006666000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000
